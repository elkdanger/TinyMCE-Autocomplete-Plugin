(function(){function o(e){return e.options==null&&typeof e!="boolean"?e.split(","):e.options}var e={};var t=40;var n=38;var r=27;var i=13;var s=[32,59,186,188,190];tinymce.create("tinymce.plugins.AutoCompletePlugin",{setOptions:function(t){e.options=o(t)},getOptions:function(){return e.options},init:function(u,a){function l(s,o){if(!e.visible&&o.keyCode!=r&&o.keyCode!=i||o.keyCode!=t&&o.keyCode!=n&&o.keyCode!=i&&o.keyCode!=r){var u=N(s);if(u.length>0){c(u)}if(u.length==0||matches.length==0){g()}}}function c(t){var n=t.replace(e.trigger,"");if(e.optionsUrl){if(n.length<=1)return false;jQuery.ajax({type:"GET",url:e.optionsUrl,cache:false,data:"q="+n,success:function(t){if(t.ok&&t.DATA){var r=[];for(var i in t.DATA){if(t.DATA[i].name)r.push(t.DATA[i].name)}e.options=r;matches=x(n);if(matches.length>0){d(matches,n,u);y()}}else{}},error:function(e,t){}})}else{matches=x(n);if(matches.length>0){d(matches,n,u);y()}}}function h(o,u){if(e.visible){if(u.keyCode==t){y();return tinymce.dom.Event.cancel(u)}if(u.keyCode==n){b();return tinymce.dom.Event.cancel(u)}if(u.keyCode==i){w(o,N(o));return tinymce.dom.Event.cancel(u)}if(u.keyCode==r){g();return tinymce.dom.Event.cancel(u)}if(e.onMatch&&s.indexOf(u.keyCode)){var a=N(o);var l=x(a);var c=new RegExp("^"+l[0]+"$","i");if(l.length==1&&a.match(c)){f.onMatch.dispatch(o,l[0])}}}}function p(e,t){g()}function d(t,n,r){var i="";var s=new RegExp("("+n+")");for(var o in t){if(typeof t[o]!=="function"){if(t[o].key!=null){i+="<li data-value='"+t[o].key+"'>"+t[o].key.replace(s,"<mark>$1</mark>")+" "+t[o].description+"</li>"}else{i+="<li data-value='"+t[o]+"'>"+t[o].replace(s,"<mark>$1</mark>")+"</li>"}}}jQuery(e.list).html(i);var u,a,f=jQuery(r.selection.getNode()).position(),l=0,c=0,h=0,p=0;if(!r.inline){var d=r.getContainer();u=jQuery(d).position();a=jQuery(d).find(".mce-toolbar").first();if(r.selection.getRng().getClientRects().length>0){var m=r.selection.getRng().getClientRects()[0];l=m.top+m.height;c=m.left}else{l=parseInt(jQuery(r.selection.getNode()).css("font-size"))*1.3+f.top;c=f.left}h=u.top+a.innerHeight()+l;p=u.left+c}else{var d=jQuery(r.bodyElement);var g=jQuery(r.selection.getNode());if(r.selection.getRng().getClientRects().length>0){var m=r.selection.getRng().getClientRects()[0];var y=jQuery(window).scrollTop();l=y+m.top+m.height;c=g.offset().left}else{u=jQuery(d).position();l=g.offset().top+parseInt(jQuery(r.selection.getNode()).css("font-size"))*1.3;c=g.offset().left}h=l;p=c}jQuery(e.list).css("top",h);jQuery(e.list).css("left",p);jQuery(e.list).css("display","block");e.visible=true;v(r)}function v(t){jQuery(e.list).find("li").hover(function(){jQuery(e.list).find("[data-selected=true]").attr("data-selected","false");jQuery(this).attr("data-selected","true")});jQuery(e.list).find("li").click(function(){w(t,N(t))})}function m(){var e=document.createElement("ul");jQuery(e).addClass("auto-list");document.body.appendChild(e);return e}function g(){jQuery(e.list).css("display","none");e.visible=false}function y(){var t=jQuery(e.list).find("[data-selected=true]");if(t.size()==0||t.next().size()==0){jQuery(e.list).find("li:first-child").attr("data-selected","true")}else{t.next().attr("data-selected","true")}t.attr("data-selected","false")}function b(){var t=jQuery(e.list).find("[data-selected=true]");if(t.size()==0||t.prev().size()==0){jQuery(e.list).find("li:last-child").attr("data-selected","true")}else{t.prev().attr("data-selected","true")}t.attr("data-selected","false")}function w(t,n){var r=jQuery(e.list).find("[data-selected=true]").attr("data-value");if(r==null){r=jQuery(e.list).find("li:first-child").attr("data-value")}var i=S(t.selection.getSel().anchorNode,"");var s=t.selection.getSel().anchorNode.textContent;var o=t.selection.getRng();o.setStart(o.startContainer,o.startOffset-n.length);t.selection.setRng(o);var u="";if(e.delimiter.length>0){u=String.fromCharCode(e.delimiter[0])}if(e.enclosing.length>0&&!E(i,s)){t.selection.setContent(e.trigger+r.toString()+e.enclosing+u)}else{t.selection.setContent(e.trigger+r.toString()+u)}g();if(e.onSelect){f.onSelect.dispatch(t,r)}}function E(t,n){var r=e.trigger+e.enclosing;t=t.substr(n.length);var i=C(e.trigger);var s=(new RegExp(i+".{"+e.enclosing.length+"}","g")).exec(t);if(s!=null&&s.length>0&&s[0]==r){return true}return false}function S(e,t){t+=e.textContent;if(e.nextSibling!=null){return S(e.nextSibling,t)}return t}function x(t){var n=e.options;var r=[];for(var i in n){if(typeof n[i]!=="function"){if(n[i].key==null&&(t.length==0||T(t,n[i]))){r.push(n[i])}else if(n[i].key!=null&&(t.length==0||T(t,n[i].key))){r.push(n[i])}}}return r}function T(e,t){var n=new RegExp("^"+e,"i");return t.match(n)}function N(t){var n=t.selection.getSel().focusNode==null?"":t.selection.getSel().focusNode.nodeValue;var r=t.selection.getSel().focusOffset;if(n==null||n.length==0){return""}var i=0;for(var s=0;s<r;s++){if(e.delimiter.indexOf(n.charCodeAt(s).toString())!=-1){i=s+1}}var o=n.substr(i,r-i);var u="";if(e.trigger==""){if(o.length>=e.minLength){u=o}}else{if(o.length>0&&o.substr(0,e.trigger.length)==e.trigger){u=o}}return u}function C(e){return e.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")}e={list:m(),visible:false,delimiter:u.getParam("autocomplete_delimiters","160,32").split(","),options:o(u.getParam("autocomplete_options","")),optionsUrl:o(u.getParam("autocomplete_options_url",false)),trigger:u.getParam("autocomplete_trigger","@"),enclosing:u.getParam("autocomplete_end_option",""),minLength:u.getParam("autocomplete_min_length","3"),onSelect:u.getParam("autocomplete_on_select",false),onMatch:u.getParam("autocomplete_on_match",false)};var f=this;if(e.onSelect){f.onSelect=new tinymce.util.Dispatcher(f);f.onSelect.add(function(e,t){e.execCallback("autocomplete_on_select",e,t)})}if(e.onMatch){f.onMatch=new tinymce.util.Dispatcher(f);f.onMatch.add(function(e,t){e.execCallback("autocomplete_on_match",e,t)})}u.on("keyup",function(e){l(u,e)});u.on("keydown",function(e){h(u,e)});u.on("click",function(e){p(u,e)})},getInfo:function(){return{longname:"AutoComplete",author:"Mijura Pty Ltd",authorurl:"http://mijura.com",infourl:"http://blog.mijura.com",version:tinymce.majorVersion+"."+tinymce.minorVersion}}});tinymce.PluginManager.add("autocomplete",tinymce.plugins.AutoCompletePlugin)})()