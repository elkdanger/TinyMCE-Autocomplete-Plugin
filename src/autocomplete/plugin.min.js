(function(){function o(e){return e.options==null&&typeof e!="boolean"?e.split(","):e.options}var e={};var t=40;var n=38;var r=27;var i=13;var s=[32,59,186,188,190];tinymce.create("tinymce.plugins.AutoCompletePlugin",{setOptions:function(t){e.options=o(t)},getOptions:function(){return e.options},init:function(s,u){function f(s,o){if(!e.visible&&o.keyCode!=r&&o.keyCode!=i||o.keyCode!=t&&o.keyCode!=n&&o.keyCode!=i&&o.keyCode!=r){var u=T(s);if(u.length>0){l(u)}if(u.length==0){m()}}}function l(t){var n=t.replace(e.trigger,"");if(e.optionsUrl){if(n.length<=1)return false;var r={q:n};if(e.customUrlData){r=jQuery.extend({},r,e.customUrlData)}jQuery.ajax({type:e.optionsUrlType,url:e.optionsUrl,cache:false,data:r,success:function(t){if(t.ok&&t.DATA){var r=[];for(var i in t.DATA){if(t.DATA[i].name)r.push(t.DATA[i].name)}e.options=r;matches=S(n);if(matches.length>0){p(matches,n,s);g()}}else{}},error:function(e,t){}})}else{matches=S(n);if(matches.length>0){p(matches,n,s);g()}}}function c(s,o){if(e.visible){if(o.keyCode==t){g();return tinymce.dom.Event.cancel(o)}if(o.keyCode==n){y();return tinymce.dom.Event.cancel(o)}if(o.keyCode==i){b(s,T(s));return tinymce.dom.Event.cancel(o)}if(o.keyCode==r){m();return tinymce.dom.Event.cancel(o)}if(e.onMatch){var u=T(s);var f=S(u);var l=new RegExp("^"+f[0]+"$","i");if(f.length==1&&u.match(l)){a.onMatch.dispatch(s,f[0])}}}}function h(e,t){m()}function p(t,n,r){var i="";var s=new RegExp("("+n+")");for(var o in t){if(typeof t[o]!=="function"){if(t[o].key!=null){i+="<li data-value='"+t[o].key+"'>"+t[o].key.replace(s,"<mark>$1</mark>")+" "+t[o].description+"</li>"}else{i+="<li data-value='"+t[o]+"'>"+t[o].replace(s,"<mark>$1</mark>")+"</li>"}}}jQuery(e.list).html(i);var u,a,f=jQuery(r.selection.getNode()).position(),l=0,c=0,h=0,p=0,v=true;if(!r.inline){var m=r.getContainer();u=jQuery(m).position();a=jQuery(m).find(".mce-toolbar").first();if(r.selection.getRng().getClientRects().length>0){var g=r.selection.getRng().getClientRects()[0];l=g.top+g.height;c=g.left}else{l=parseInt(jQuery(r.selection.getNode()).css("font-size"))*1.3+f.top;c=f.left}h=u.top+a.innerHeight()+l;p=u.left+c}else{var m=jQuery(r.bodyElement);var y=jQuery(r.selection.getNode());if(r.selection.getRng().getClientRects().length>0){var g=r.selection.getRng().getClientRects()[0];var b=jQuery(window).scrollTop();l=b+g.top+g.height;c=g.left}else{v=false}h=l;p=c}if(v){jQuery(e.list).css("top",h);jQuery(e.list).css("left",p);jQuery(e.list).css("display","block");e.visible=true;d(r)}}function d(t){jQuery(e.list).find("li").hover(function(){jQuery(e.list).find("[data-selected=true]").attr("data-selected","false");jQuery(this).attr("data-selected","true")});jQuery(e.list).find("li").click(function(){b(t,T(t))})}function v(){var e=document.createElement("ul");jQuery(e).addClass("auto-list");document.body.appendChild(e);return e}function m(){jQuery(e.list).css("display","none");e.visible=false}function g(){var t=jQuery(e.list).find("[data-selected=true]");if(t.size()==0||t.next().size()==0){jQuery(e.list).find("li:first-child").attr("data-selected","true")}else{t.next().attr("data-selected","true")}t.attr("data-selected","false")}function y(){var t=jQuery(e.list).find("[data-selected=true]");if(t.size()==0||t.prev().size()==0){jQuery(e.list).find("li:last-child").attr("data-selected","true")}else{t.prev().attr("data-selected","true")}t.attr("data-selected","false")}function b(t,n){var r=jQuery(e.list).find("[data-selected=true]").attr("data-value");if(r==null){r=jQuery(e.list).find("li:first-child").attr("data-value")}var i=E(t.selection.getSel().anchorNode,"");var s=t.selection.getSel().anchorNode.textContent;var o=t.selection.getRng();o.setStart(o.startContainer,o.startOffset-n.length-e.trigger.length);t.selection.setRng(o);var u="";if(e.delimiter.length>0){u=String.fromCharCode(e.delimiter[0])}var f="";if(e.enclosing.length>0&&!w(i,s)){f=e.trigger+r.toString()+e.enclosing+u}else{f=e.trigger+r.toString()+u}t.selection.setContent(f);m();if(e.onSelect){a.onSelect.dispatch(t,r)}}function w(t,n){var r=e.trigger+e.enclosing;t=t.substr(n.length);var i=N(e.trigger);var s=(new RegExp(i+".{"+e.enclosing.length+"}","g")).exec(t);if(s!=null&&s.length>0&&s[0]==r){return true}return false}function E(e,t){t+=e.textContent;if(e.nextSibling!=null){return E(e.nextSibling,t)}return t}function S(t){var n=e.options;var r=[];for(var i in n){if(typeof n[i]!=="function"){if(n[i].key==null&&(t.length==0||x(t,n[i]))){r.push(n[i])}else if(n[i].key!=null&&(t.length==0||x(t,n[i].key))){r.push(n[i])}}}return r}function x(e,t){var n=new RegExp("^"+e,"i");return t.match(n)}function T(t){var n=t.selection.getSel().focusNode==null?"":t.selection.getSel().focusNode.nodeValue;var r=t.selection.getSel().focusOffset;if(n==null||n.length==0){return""}var i=e.trigger.length;var s=-1;var o=-1;for(var u=r;u>-1;u--){if(n.substr(u,i)==e.trigger&&s==-1){s=u}}if(s>-1){for(var u=s;u<n.length;u++){var a=n[u];if(u<n.length-e.enclosing.length){if(n.substr(u,e.enclosing.length)==e.enclosing){o=u+1}}}if(o==-1){o=r}else if(r>o){return""}var f=n.substr(s+i,o);var l="";if(e.trigger==""){if(f.length>=e.minLength){l=f}}else{l=f}}else{return""}return l}function N(e){return e.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")}function C(e){return jQuery("<p>").append(e.eq(0).clone()).html()}e={list:v(),visible:false,delimiter:s.getParam("autocomplete_delimiters","160,32").split(","),options:o(s.getParam("autocomplete_options","")),optionsUrl:o(s.getParam("autocomplete_options_url",false)),trigger:s.getParam("autocomplete_trigger","@"),enclosing:s.getParam("autocomplete_end_option",""),minLength:s.getParam("autocomplete_min_length","3"),onSelect:s.getParam("autocomplete_on_select",false),onMatch:s.getParam("autocomplete_on_match",false),customUrlData:s.getParam("autocomplete_url_custom_data",false),optionsUrlType:s.getParam("autocomplete_url_type","GET")};var a=this;if(e.onSelect){a.onSelect=new tinymce.util.Dispatcher(a);a.onSelect.add(function(e,t){e.execCallback("autocomplete_on_select",e,t)})}if(e.onMatch){a.onMatch=new tinymce.util.Dispatcher(a);a.onMatch.add(function(e,t){e.execCallback("autocomplete_on_match",e,t)})}s.on("keyup",function(e){f(s,e)});s.on("keydown",function(e){c(s,e)});s.on("click",function(e){h(s,e)})},getInfo:function(){return{longname:"AutoComplete",author:"Mijura Pty Ltd",authorurl:"http://mijura.com",infourl:"http://blog.mijura.com",version:tinymce.majorVersion+"."+tinymce.minorVersion}}});tinymce.PluginManager.add("autocomplete",tinymce.plugins.AutoCompletePlugin)})()